<div class="p-4 bg-white">
    <div class="mb-4">
        <users-download-button [users]="users"></users-download-button>
    </div>

    <div class="overflow-x-auto rounded-lg shadow-lg">
        @if (pending) {
            <div class="text-center p-4 text-quinary font-primary">Cargando usuarios...</div>
        } @else if (paginatedUsers.length === 0) {
            <div class="text-center p-4 text-quinary font-primary">No hay usuarios para mostrar.</div>
        } @else {
            <table class="min-w-full divide-y divide-gray-200">
                <thead [style.backgroundColor]="'#' + colors.primary_color" [style.color]="'#' + colors.neutral_color">
                    <tr>
                        <th (click)="sortTable('id_user')" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider cursor-pointer">
                            ID
                            @if (sortColumn === 'id_user') {
                                <span>{{ sortDirection === 'asc' ? ' ▲' : ' ▼' }}</span>
                            }
                        </th>
                        <th (click)="sortTable('name_user')" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider cursor-pointer">
                            Nombre
                            @if (sortColumn === 'name_user') {
                                <span>{{ sortDirection === 'asc' ? ' ▲' : ' ▼' }}</span>
                            }
                        </th>
                        <th (click)="sortTable('maiden_name_user')" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider cursor-pointer">
                            Apellido
                            @if (sortColumn === 'maiden_name_user') {
                                <span>{{ sortDirection === 'asc' ? ' ▲' : ' ▼' }}</span>
                            }
                        </th>
                        <th (click)="sortTable('email_user')" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider cursor-pointer">
                            Email
                            @if (sortColumn === 'email_user') {
                                <span>{{ sortDirection === 'asc' ? ' ▲' : ' ▼' }}</span>
                            }
                        </th>
                        <th (click)="sortTable('username')" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider cursor-pointer">
                            Usuario
                            @if (sortColumn === 'username') {
                                <span>{{ sortDirection === 'asc' ? ' ▲' : ' ▼' }}</span>
                            }
                        </th>
                        <th (click)="sortTable('role_user')" class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider cursor-pointer">
                            Rol
                            @if (sortColumn === 'role_user') {
                                <span>{{ sortDirection === 'asc' ? ' ▲' : ' ▼' }}</span>
                            }
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider">
                            Acciones
                        </th>
                    </tr>
                </thead>
                <tbody [style.backgroundColor]="'#' + colors.cuarternary_color" [style.color]="'#' + colors.neutral_color">
                    @for (user of paginatedUsers; track user.id_user) {
                        <tr class="hover:bg-opacity-80" [style.backgroundColor]="'#' + colors.cuarternary_color" [style.color]="'#' + colors.neutral_color"
                            [style.transition]="'background-color 0.2s ease-in-out'"
                            >
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">{{ user.id_user }}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm">{{ user.name_user }}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm">{{ user.maiden_name_user }}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm">{{ user.email_user }}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm">{{ user.username }}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm">
                                <span
                                    class="px-2 py-1 rounded text-xs font-semibold"
                                    [style.backgroundColor]="user.role_user === 'admin' ? '#' + colors.secondary_color + '20' : '#' + colors.primary_color"
                                    [style.color]="user.role_user === 'admin' ? '#' + colors.secondary_color : '#' + colors.neutral_color"
                                >
                                    {{ user.role_user }}
                                </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm">
                                <div class="flex gap-2">
                                    <button
                                        class="bg-[#F97316] hover:bg-[#ea580c] text-white px-3 py-1 rounded text-xs"
                                        [style.backgroundColor]="'#' + colors.ternary_color"
                                        (click)="openUserDetails(user)"
                                    >
                                        Ver
                                    </button>
                                    <button
                                        class="text-white px-3 py-1 rounded text-xs"
                                        [ngClass]="{
                                            'bg-red-600 hover:bg-red-700': user.is_active_user === 1,
                                            'bg-green-600 hover:bg-green-700': user.is_active_user === 0
                                        }"
                                        (click)="toggleUserActive(user)"
                                    >
                                        {{ user.is_active_user === 1 ? 'Desactivar' : 'Activar' }}
                                    </button>
                                </div>
                            </td>
                        </tr>
                    } @empty {
                        <tr>
                            <td colspan="7" class="px-6 py-4 text-center text-sm text-gray-500">No hay usuarios disponibles.</td>
                        </tr>
                    }
                </tbody>
            </table>
        }
    </div>

    @if (!pending && users.length > 0) {
        <div class="flex justify-between items-center mt-4">
            <button
                (click)="prevPage()"
                [disabled]="currentPage === 1"
                class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed"
            >
                Anterior
            </button>
            <span class="text-sm text-gray-700">Página {{ currentPage }} de {{ totalPages }}</span>
            <button
                (click)="nextPage()"
                [disabled]="currentPage === totalPages"
                class="px-4 py-2 bg-gray-200 text-gray-700 rounded-md hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed"
            >
                Siguiente
            </button>
        </div>
    }

    <user-details
        [user]="selectedUser"
        [isOpen]="isModalOpen"
        (onClose)="closeUserDetails()"
    ></user-details>
</div>